# Copyright 2026 GoodRx, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

nameOverride: ""
fullnameOverride: ""

annotations: {}
extraLabels: {}

realm: lifecycle
realmDisplayName: Lifecycle
hostname: http://localhost:8080
hostnameStrict: true

clients:
  lifecycleCore:
    enabled: true
    clientId: lifecycle-core
    clientSecret: lifecycle-core-secret

  lifecycleUi:
    enabled: true
    clientId: lifecycle-ui
    clientSecret: lifecycle-ui-secret
    url: http://localhost:3000

  lifecycleUiBackend:
    enabled: true
    clientId: lifecycle-ui-backend
    clientSecret: lifecycle-ui-backend-secret

companyIdp:
  enabled: true
  clientId:  # fallback to "${vault.company_idp_client_id}"
  clientSecret:  # fallback to "${vault.company_idp_client_secret}"
  tokenUrl:  # fallback to "{{ .Values.hostname }}/realms/{{ .Values.realm }}/protocol/openid-connect/token"
  authorizationUrl:  # fallback to "{{ .Values.hostname }}/realms/{{ .Values.realm }}/protocol/openid-connect/auth"
  jwksUrl:  # fallback to "{{ .Values.hostname }}/realms/{{ .Values.realm }}/protocol/openid-connect/certs"

githubIdp:
  enabled: true
  clientId:
    secretKeyRef:
      name:  # fallback to "{{ include "lifecycle-keycloak.githubIdpSecretName" . }}"
      key:  # default "clientId"
  clientSecret:
    secretKeyRef:
      name:  # fallback to "{{ include "lifecycle-keycloak.githubIdpSecretName" . }}"
      key:  # default "clientSecret"

internalIdp:
  realm: internal
  displayName: "Internal SSO"
  clientId: internal-sso-client
  users:
    bootstrapUser:
      username: lifecycle
      email: lifecycle@example.com
      firstName: Lifecycle
      lastName: Bootstrap
      password: lifecycle
      credsTemp: true

instances: 1

ingress:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-dns"
    nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  className: nginx
  tls: false

secrets:
  bootstrapAdmin:
    enabled: true
    fullnameOverride: ""
    annotations: []
    username: "bootstrap-admin"
    password: ""

  postgres:
    enabled: true
    fullnameOverride: ""
    annotations: []
    adminPassword: ""
    userPassword: ""

  githubIdp:
    enabled: false
    fullnameOverride: ""
    annotations: []
    clientId:
    clientSecret:


postgres:
  enabled: true
  fullnameOverride: ""

  # Values passed directly to the bitnami/postgresql subchart.
  # Refer to Bitnami PostgreSQL chart docs for all options:
  # https://github.com/bitnami/charts/tree/main/bitnami/postgresql

  image:
    repository: bitnamilegacy/postgresql
  auth:
    database: keycloak
    username: keycloak
    existingSecret: '{{ include "lifecycle-keycloak.postgresSecretName" . }}'
    secretKeys:
      adminPasswordKey: "POSTGRES_ADMIN_PASSWORD"
      userPasswordKey: "POSTGRES_USER_PASSWORD"

  primary:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
